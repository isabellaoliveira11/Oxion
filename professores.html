<div id="professores-page-content">
  <div class="p-6">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold">Professores</h1>
      <button id="add-professor-btn" class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 text-sm font-semibold flex items-center gap-2">
        <i data-lucide="plus" class="w-4 h-4"></i> Adicionar Professor
      </button>
    </div>

    <input type="text" id="search-input" placeholder="Busque por nome, e-mail ou matéria..." class="w-full border rounded-lg px-4 py-2 mb-4 focus:outline-none focus:ring-2 focus:ring-orange-500" />

    <div class="overflow-x-auto bg-white rounded-lg shadow-sm border">
      <table class="w-full table-auto text-left text-sm">
        <thead class="bg-gray-50 text-gray-600 uppercase text-xs">
          <tr>
            <th class="p-3 font-semibold">Nome</th>
            <th class="p-3 font-semibold">E-mail</th>
            <th class="p-3 font-semibold">Matéria Principal</th>
            <th class="p-3 font-semibold">Taxa/Hora (R$)</th>
            <th class="p-3 font-semibold">Status</th>
            <th class="p-3 font-semibold text-right">Ações</th>
          </tr>
        </thead>
        <tbody id="professores-lista">
          </tbody>
      </table>
    </div>
  </div>
</div>


<div id="professor-modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
  <div class="modal-container bg-white w-full max-w-lg rounded-xl shadow-lg">
    <div class="flex items-center justify-between px-6 py-4 border-b">
      <h4 id="modal-title" class="text-lg font-semibold">Adicionar Novo Professor</h4>
      <button id="modal-close-btn" class="p-2 rounded-full hover:bg-gray-100"><i data-lucide="x" class="w-5 h-5"></i></button>
    </div>
    
    <form id="professor-form" class="p-6 space-y-4">
      <input type="hidden" id="professor-id">
      <div>
          <label class="block text-sm font-medium mb-1">Nome Completo *</label>
          <input type="text" id="professor-nome" required class="w-full border rounded-lg px-3 py-2">
      </div>
      <div>
          <label class="block text-sm font-medium mb-1">E-mail *</label>
          <input type="email" id="professor-email" required class="w-full border rounded-lg px-3 py-2">
      </div>
       <div>
          <label class="block text-sm font-medium mb-1">Matéria Principal</label>
          <input type="text" id="professor-materia" class="w-full border rounded-lg px-3 py-2">
      </div>
       <div>
          <label class="block text-sm font-medium mb-1">Taxa/Hora (R$)</label>
          <input type="number" step="0.01" id="professor-taxa" class="w-full border rounded-lg px-3 py-2">
      </div>
       <div>
          <label class="block text-sm font-medium mb-1">Status</label>
          <select id="professor-status" class="w-full border rounded-lg px-3 py-2 bg-white">
            <option>Ativo</option>
            <option>Inativo</option>
          </select>
      </div>
      <div class="flex items-center justify-end gap-3 pt-4">
        <button type="button" id="modal-cancel-btn" class="px-4 py-2 rounded-lg border hover:bg-gray-50 font-semibold">Cancelar</button>
        <button type="submit" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-semibold">Salvar</button>
      </div>
    </form>
  </div>
</div>

<script>
if (document.getElementById('professores-page-content')) {

  const STORAGE_KEY_PROFESSORES = 'oxion_professores';

  const getProfessores = () => JSON.parse(localStorage.getItem(STORAGE_KEY_PROFESSORES)) || [];
  const saveProfessores = (data) => localStorage.setItem(STORAGE_KEY_PROFESSORES, JSON.stringify(data));
  const uid = () => `prof-${Date.now().toString(36)}-${Math.random().toString(36).substr(2)}`;

  const seedProfessores = () => {
    if (getProfessores().length > 0) return;
    const professoresIniciais = [
      { id: uid(), nome: 'Admin Oxion', email: 'admin@oxion.com', materia: 'Inglês', taxa: '100', status: 'Ativo' },
      { id: uid(), nome: 'Ana Costa', email: 'ana.costa@example.com', materia: 'Espanhol', taxa: '80', status: 'Ativo' },
      { id: uid(), nome: 'Carlos Souza', email: 'carlos.souza@example.com', materia: 'Francês', taxa: '95', status: 'Inativo' },
    ];
    saveProfessores(professoresIniciais);
  };
  
  const addBtn = document.getElementById('add-professor-btn');
  const modal = document.getElementById('professor-modal');
  const modalCloseBtn = document.getElementById('modal-close-btn');
  const modalCancelBtn = document.getElementById('modal-cancel-btn');
  const form = document.getElementById('professor-form');
  const searchInput = document.getElementById('search-input');
  const professoresLista = document.getElementById('professores-lista');
  const modalTitle = document.getElementById('modal-title');
  
  const openModal = (prof = null) => {
    form.reset();
    document.getElementById('professor-id').value = '';
    if (prof) {
      modalTitle.textContent = 'Editar Professor';
      document.getElementById('professor-id').value = prof.id;
      document.getElementById('professor-nome').value = prof.nome;
      document.getElementById('professor-email').value = prof.email;
      document.getElementById('professor-materia').value = prof.materia;
      document.getElementById('professor-taxa').value = prof.taxa;
      document.getElementById('professor-status').value = prof.status;
    } else {
      modalTitle.textContent = 'Adicionar Novo Professor';
    }
    modal.classList.remove('hidden');
    modal.classList.add('flex');
    lucide.createIcons();
  };
  
  const closeModal = () => modal.classList.add('hidden');
  
  const renderProfessores = () => {
    const professores = getProfessores();
    const searchTerm = searchInput.value.toLowerCase();
    
    const filtered = professores.filter(p => 
      p.nome.toLowerCase().includes(searchTerm) ||
      p.email.toLowerCase().includes(searchTerm) ||
      p.materia.toLowerCase().includes(searchTerm)
    );
    
    professoresLista.innerHTML = '';
    if (filtered.length === 0) {
      professoresLista.innerHTML = `<tr><td colspan="6" class="text-center text-gray-500 p-6">Nenhum professor encontrado.</td></tr>`;
      return;
    }
    
    filtered.forEach(prof => {
      const row = document.createElement('tr');
      row.className = 'border-t hover:bg-gray-50';
      row.innerHTML = `
        <td class="p-3 font-medium">${prof.nome}</td>
        <td class="p-3">${prof.email}</td>
        <td class="p-3">${prof.materia}</td>
        <td class="p-3">${prof.taxa}</td>
        <td class="p-3"><span class="px-2 py-1 rounded-full text-xs font-medium ${prof.status === 'Ativo' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">${prof.status}</span></td>
        <td class="p-3 text-right space-x-2">
          <button data-id="${prof.id}" class="edit-btn px-3 py-1 bg-gray-100 rounded hover:bg-gray-200 text-xs font-semibold">Editar</button>
          <button data-id="${prof.id}" class="delete-btn px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-xs font-semibold">Excluir</button>
        </td>
      `;
      professoresLista.appendChild(row);
    });
  };

  addBtn.addEventListener('click', () => openModal());
  modalCloseBtn.addEventListener('click', closeModal);
  modalCancelBtn.addEventListener('click', closeModal);
  modal.addEventListener('click', e => { if (e.target === modal) closeModal(); });
  searchInput.addEventListener('input', renderProfessores);
  
  form.addEventListener('submit', e => {
    e.preventDefault();
    const id = document.getElementById('professor-id').value;
    const profData = {
      id: id || uid(),
      nome: document.getElementById('professor-nome').value,
      email: document.getElementById('professor-email').value,
      materia: document.getElementById('professor-materia').value,
      taxa: document.getElementById('professor-taxa').value,
      status: document.getElementById('professor-status').value,
    };

    let professores = getProfessores();
    if (id) {
      professores = professores.map(p => p.id === id ? profData : p);
    } else {
      professores.push(profData);
    }
    saveProfessores(professores);
    renderProfessores();
    closeModal();
  });
  
  professoresLista.addEventListener('click', e => {
    const target = e.target.closest('button');
    if (!target) return;

    const id = target.dataset.id;
    if (target.classList.contains('edit-btn')) {
      const prof = getProfessores().find(p => p.id === id);
      openModal(prof);
    }
    if (target.classList.contains('delete-btn')) {
      if (confirm('Tem certeza que deseja excluir este professor?')) {
        saveProfessores(getProfessores().filter(p => p.id !== id));
        renderProfessores();
      }
    }
  });

  seedProfessores();
  renderProfessores();
  lucide.createIcons();
}
</script>